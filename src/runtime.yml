variant: fcos
version: 1.0.0

systemd:
  units:
    - name: vault.service
      enabled: true
      contents: |
        [Unit]
        Description=secret manager pod service

        [Service]
        Type=oneshot
        ExecStartPre=/usr/bin/podman pod rm secret
        ExecStartPre=/usr/bin/podman pod create --name secret
        ExecStart=/usr/bin/podman run --name vault -d --pod secret -v /var/lib/vault/config/:/vault/config/:ro -v /var/lib/vault/data/:/vault/file/:z vault:latest server
        ExecStop=/usr/bin/podman pod stop secret
        RemainAfterExit=yes
        KillMode=none

        [Install]
        WantedBy=multi-user.target

    - name: gitea.service
      enabled: true
      contents: |
        [Unit]
        Description=gitea pod

        [Service]
        Type=oneshot
        ExecStartPre=/usr/bin/podman pod rm gitea
        ExecStartPre=/usr/bin/podman pod create --name gitea -p 2222:22 -p 80:3000
        ExecStartPre=/usr/bin/podman run --name gitea-db -d --pod gitea -v /var/lib/gitea/db/:/var/lib/mysql:z -e MYSQL_RANDOM_ROOT_PASSWORD=yes -e MYSQL_DATABASE="gitea" -e MYSQL_USER="gitea" -e MYSQL_PASSWORD="Ch@ng3M3" mariadb:10.5.1
        ExecStart=/usr/bin/podman run --name gitea-app -d --pod gitea -v /var/lib/gitea/:/data:z gitea/gitea:1.11.3
        ExecStop=/usr/bin/podman pod stop gitea
        RemainAfterExit=yes
        KillMode=none

        [Install]
        WantedBy=multi-user.target
